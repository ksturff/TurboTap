<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Turbo Tap Parkour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    body { margin: 0; overflow: hidden; background: #0d0d0d; }
    canvas { display: block; margin: 0 auto; background: #0d0d0d; }
    #startScreen, #pauseBtn, #resumeBtn, #restartBtn, #gameOverScreen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 15px 30px;
      font-size: 20px;
      background: #ff3366;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #startScreen { display: block; }
    #pauseBtn { top: 20px; left: 40%; transform: translateX(-50%); display: none; }
    #resumeBtn { top: 20px; left: 60%; transform: translateX(-50%); display: none; }
    #restartBtn { display: none; }
    #gameOverScreen { display: none; }
    #coinCounter, #distanceCounter {
      position: absolute;
      color: white;
      font-size: 20px;
      font-family: sans-serif;
    }
    #coinCounter { top: 20px; left: 20px; }
    #distanceCounter { top: 20px; right: 20px; }
  </style>
</head>

<body>
<canvas id="gameCanvas" width="480" height="720"></canvas>
<div id="coinCounter">Coins: 0</div>
<div id="distanceCounter">Distance: 0m</div>
<button id="startScreen" onclick="startGame()">Start Game</button>
<button id="pauseBtn" onclick="pauseGame()">Pause</button>
<button id="resumeBtn" onclick="resumeGame()">Resume</button>
<button id="restartBtn" onclick="restartGame()">Restart</button>
<button id="gameOverScreen" onclick="restartGame()">Game Over - Click to Restart</button>

<audio id="jumpSound" src="assets/jump.mp3"></audio>
<audio id="coinSound" src="assets/coin.mp3"></audio>
<audio id="powerupSound" src="assets/powerup.mp3"></audio>
<audio id="deathSound" src="assets/death.mp3"></audio>

<script>
let gameStarted = false;
let gamePaused = false;
let gameOver = false;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = { x: 50, y: 500, width: 30, height: 30, vy: 0 };
let platforms = [{ x: 0, y: 550, width: 480, height: 20, obstacle: false }];
let coins = [];
let distance = 0;
let speed = 3;
let collectedCoins = 0;

function startGame() {
  startScreen.style.display = 'none';
  gameOverScreen.style.display = 'none';
  pauseBtn.style.display = 'block';
  restartBtn.style.display = 'none';
  gameStarted = true;
  gamePaused = false;
  requestAnimationFrame(gameLoop);
}

function pauseGame() {
  gamePaused = true;
  pauseBtn.style.display = 'none';
  resumeBtn.style.display = 'block';
}

function resumeGame() {
  gamePaused = false;
  resumeBtn.style.display = 'none';
  pauseBtn.style.display = 'block';
  requestAnimationFrame(gameLoop);
}

function endGame() {
  deathSound.play();
  gameOver = true;
  gameStarted = false;
  pauseBtn.style.display = 'none';
  resumeBtn.style.display = 'none';
  gameOverScreen.innerText = `Game Over!\nYou ran ${Math.floor(distance)} meters\nCollected ${collectedCoins} coins\nClick to Restart`;
  gameOverScreen.style.display = 'block';
}

function restartGame() {
  window.location.reload();
}

document.addEventListener('keydown', function(e) {
  if (e.code === 'Space' && player.vy === 0) {
    player.vy = -12;
    jumpSound.play();
  }
});

canvas.addEventListener('touchstart', function() {
  if (player.vy === 0) {
    player.vy = -12;
    jumpSound.play();
  }
});

function gameLoop() {
  if (!gameStarted || gamePaused || gameOver) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  distance += 0.1;
  document.getElementById('distanceCounter').innerText = `Distance: ${Math.floor(distance)}m`;
  document.getElementById('coinCounter').innerText = `Coins: ${collectedCoins}`;

  speed += 0.0005;

  // Move platforms and coins
  for (let plat of platforms) plat.x -= speed;
  for (let coin of coins) coin.x -= speed;

  // Generate new platforms
  if (platforms[platforms.length - 1].x < 300) {
    const platWidth = 80 + Math.random() * 120;
    const platHeight = 20;
    const platY = 400 + Math.random() * 250;
    const hasObstacle = Math.random() < 0.3;
    platforms.push({ x: 480, y: platY, width: platWidth, height: platHeight, obstacle: hasObstacle });

    if (Math.random() < 0.5) {
      coins.push({ x: 480 + platWidth / 2 - 10, y: platY - 30, width: 20, height: 20 });
    }
  }

  // Cleanup old platforms and coins
  if (platforms[0].x + platforms[0].width < 0) platforms.shift();
  if (coins.length > 0 && coins[0].x + coins[0].width < 0) coins.shift();

  // Gravity
  player.vy += 0.5;
  player.y += player.vy;

  let onGround = false;
  for (let plat of platforms) {
    if (player.x + player.width > plat.x && player.x < plat.x + plat.width &&
        player.y + player.height > plat.y && player.y + player.height < plat.y + plat.height + 10 && player.vy >= 0) {
      player.y = plat.y - player.height;
      player.vy = 0;
      onGround = true;
    }

    if (plat.obstacle) {
      const obstacleX = plat.x + plat.width / 2 - 10;
      const obstacleY = plat.y - 20;
      const obstacleW = 20;
      const obstacleH = 20;

      if (player.x + player.width > obstacleX && player.x < obstacleX + obstacleW &&
          player.y + player.height > obstacleY && player.y < obstacleY + obstacleH) {
        endGame();
        return;
      }
